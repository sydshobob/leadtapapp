
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Select ZIP Codes – LeadTapApp</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script defer>
    document.addEventListener("DOMContentLoaded", () => {
      const states = [
        "AK","AL","AR","AS","AZ","CA","CO","CT","DC","DE","FL","GA","GU","HI","IA","ID",
        "IL","IN","KS","KY","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","ND","NE",
        "NH","NJ","NM","NV","NY","OH","OK","OR","PA","PR","RI","SC","SD","TN","TX","UT",
        "VA","VI","VT","WA","WI","WV","WY"
      ];

      const grid = document.getElementById("stateGrid");
      states.forEach(code => {
        const btn = document.createElement("button");
        btn.textContent = code;
        btn.className = "state-btn bg-white border rounded px-3 py-2 hover:bg-blue-100";
        btn.onclick = () => loadCitiesByState(code);
        grid.appendChild(btn);
      });
    });

    async function loadCitiesByState(stateCode) {
      const cityContainer = document.getElementById("cityList");
      cityContainer.innerHTML = `<p class='text-sm text-gray-500'>Loading ${stateCode}...</p>`;
      try {
        const res = await fetch(`zip_map_${stateCode}.json`);
        if (!res.ok) throw new Error(`Missing file for ${stateCode}`);
        const data = await res.json();

        const grouped = {};
        data.forEach(entry => {
          const firstLetter = entry.City.charAt(0).toUpperCase();
          if (!grouped[firstLetter]) grouped[firstLetter] = [];
          grouped[firstLetter].push(entry);
        });

        const sortedLetters = Object.keys(grouped).sort();
        cityContainer.innerHTML = "";

        sortedLetters.forEach(letter => {
          const section = document.createElement("div");
          section.className = "mb-4";

          const heading = document.createElement("h3");
          heading.className = "text-md font-bold text-gray-700 mb-2";
          heading.textContent = letter;
          section.appendChild(heading);

          grouped[letter].forEach((entry, index) => {
            const label = document.createElement("label");
            label.className = "block text-base text-gray-800 mb-1";
            label.innerHTML = `<input type="checkbox" data-zips='${JSON.stringify(entry["Zip Codes"])}' onchange="handleCityCheck(this)" class="mr-2"> ${entry.City}`;
            section.appendChild(label);
          });

          cityContainer.appendChild(section);
        });

      } catch (err) {
        cityContainer.innerHTML = `<p class='text-red-600'>Failed to load cities for ${stateCode}.</p>`;
        console.error(err);
      }
    }

    function handleCityCheck(checkbox) {
      const zipContainer = document.getElementById("zipList");
      const zips = JSON.parse(checkbox.getAttribute("data-zips"));
      const currentZipCount = document.querySelectorAll('#zipList input[type="checkbox"]').length;

      if (checkbox.checked) {
        if (currentZipCount + zips.length > 5) {
          alert("You can only select up to 5 ZIP codes.");
          checkbox.checked = false;
          return;
        }
        zips.forEach(zip => {
          const id = `zip_${zip}`;
          if (!document.getElementById(id)) {
            const label = document.createElement("label");
            label.className = "block";
            label.innerHTML = `<input type="checkbox" id="${id}" checked disabled> ${zip}`;
            zipContainer.appendChild(label);
          }
        });
      } else {
        zips.forEach(zip => {
          const el = document.getElementById(`zip_${zip}`);
          if (el) el.parentElement.remove();
        });
      }
    }

    function showSummary() {
      const zipCheckboxes = document.querySelectorAll('#zipList input[type="checkbox"]');
      const zipCount = zipCheckboxes.length;

      const summary = document.getElementById("summaryList");
      summary.innerHTML = "";
      zipCheckboxes.forEach(zip => {
        const li = document.createElement("li");
        li.textContent = zip.parentElement.textContent.trim();
        summary.appendChild(li);
      });

      document.getElementById("summaryZipCount").textContent = zipCount;
      document.getElementById("selectorSection").classList.add("hidden");
      document.getElementById("summarySection").classList.remove("hidden");
    }

    function goBack() {
      document.getElementById("summarySection").classList.add("hidden");
      document.getElementById("selectorSection").classList.remove("hidden");
    }

    function finalSubmit() {
      alert("Feature coming soon – save or send ZIPs!");
    }
  </script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div id="selectorSection" class="max-w-5xl mx-auto px-6 py-10">
    <h1 class="text-3xl font-bold mb-6">Choose Your Service Area</h1>

    <p class="mb-4 text-sm text-gray-600">Choose cities from as many states as you want. You can select up to <strong>5 ZIP codes total</strong>.</p>

    <div id="stateGrid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2 mb-6"></div>

    <div class="mb-8">
      <label class="block font-semibold mb-2">Cities</label>
      <div id="cityList" class="border p-4 bg-white rounded-md max-h-96 overflow-y-scroll text-sm"></div>
    </div>

    <div class="mb-8">
      
<div class="mb-2 flex items-center gap-2">
  <label class="block font-semibold">Selected ZIP Codes</label>
  <div class="relative group">
    <span class="text-blue-600 cursor-pointer text-sm underline">Why Only 5 ZIP Codes?</span>
    <div class="absolute hidden group-hover:block w-64 p-3 bg-white text-sm text-gray-800 border border-gray-300 rounded shadow-lg z-10 top-full left-0 mt-1">
      For best results, we recommend focusing your marketing on the areas where you already perform best. 3–4 ZIP codes tend to deliver the highest ROI. You can update your ZIP selections anytime.
    </div>
  </div>
</div>

      <div id="zipList" class="border p-4 bg-white rounded-md max-h-48 overflow-y-scroll text-sm"></div>
    </div>

    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded mb-6">
      <p><strong>Best Practice:</strong> Focusing on your top ZIP codes brings the best ROI. You can change these at any time.</p>
    </div>

    <button onclick="showSummary()" class="bg-blue-700 text-white font-semibold px-6 py-3 rounded-xl hover:bg-blue-800">Continue</button>
  </div>

  <div id="summarySection" class="hidden bg-white p-6 rounded-md shadow-md max-w-4xl mx-auto mt-8">
    <h2 class="text-2xl font-bold mb-4">Your Selected ZIP Codes</h2>
    <ul id="summaryList" class="list-disc ml-5 mb-2 text-gray-700"></ul>
    <p><strong>Total ZIP Codes:</strong> <span id="summaryZipCount">0</span></p>

    <div class="mt-6 flex gap-4">
      <button onclick="goBack()" class="bg-gray-300 text-gray-800 font-semibold px-4 py-2 rounded-md hover:bg-gray-400">Go Back</button>
      <button onclick="finalSubmit()" class="bg-blue-700 text-white font-semibold px-4 py-2 rounded-md hover:bg-blue-800">Looks Good – Continue</button>
    </div>
  </div>
</body>
</html>
