
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LeadTap ZIP Selector v1.1</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script defer>
    let currentState = null;
    let cityData = {};
    const maxZips = 5;

    document.addEventListener("DOMContentLoaded", () => {
      const states = [
        "AK","AL","AR","AS","AZ","CA","CO","CT","DC","DE","FL","GA","GU","HI","IA","ID",
        "IL","IN","KS","KY","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","ND","NE",
        "NH","NJ","NM","NV","NY","OH","OK","OR","PA","PR","RI","SC","SD","TN","TX","UT",
        "VA","VI","VT","WA","WI","WV","WY"
      ];

      const stateList = document.getElementById("stateList");
      states.forEach(code => {
        const btn = document.createElement("button");
        btn.textContent = code;
        btn.className = "block w-full text-left px-3 py-2 hover:bg-blue-100 border-b";
        btn.onclick = () => loadCities(code);
        stateList.appendChild(btn);
      });
    });

    async function loadCities(stateCode) {
      if (currentState === stateCode) return;
      currentState = stateCode;
      const cityList = document.getElementById("cityList");
      const zipList = document.getElementById("zipList");
      cityList.innerHTML = "<p class='text-sm text-gray-500'>Loading cities...</p>";
      zipList.innerHTML = "";

      try {
        if (!cityData[stateCode]) {
          const res = await fetch(`zip_map_${stateCode}.json`);
          const data = await res.json();
          cityData[stateCode] = data;
        }

        const cities = cityData[stateCode];
        cityList.innerHTML = "";
        cities.forEach(entry => {
          const label = document.createElement("label");
          label.className = "block text-sm text-gray-800 mb-1";
          label.innerHTML = `<input type="checkbox" data-state="${stateCode}" data-city="${entry.City}" data-zips='${JSON.stringify(entry["Zip Codes"])}' onchange="toggleCitySelection(this)" class="mr-2"> ${entry.City}`;
          cityList.appendChild(label);
        });
      } catch (err) {
        cityList.innerHTML = "<p class='text-red-600'>Failed to load cities.</p>";
      }
    }

    function toggleCitySelection(checkbox) {
      const zipList = document.getElementById("zipList");
      const summaryList = document.getElementById("summaryList");
      const counter = document.getElementById("zipCounter");
      const state = checkbox.dataset.state;
      const city = checkbox.dataset.city;
      const zips = JSON.parse(checkbox.dataset.zips);

      if (checkbox.checked) {
        const zipCount = document.querySelectorAll("#summaryList li").length + zips.length;
                
        const zipContainer = document.createElement("div");
        zipContainer.id = `zips_${state}_${city}`;
        zipContainer.className = "mb-4";
        zipContainer.innerHTML = `<div class="font-semibold text-sm mb-1">${city}</div>`;

        zips.forEach(zip => {
          const label = document.createElement("label");
          label.className = "block text-xs text-gray-800 mb-1";
          label.innerHTML = `<input type="checkbox" data-state="${state}" data-city="${city}" data-zip="${zip}" onchange="toggleZipSelection(this)" class="mr-1 zip-check"> ${zip}`;
          zipContainer.appendChild(label);
        });
        zipList.appendChild(zipContainer);

        zipContainer.className = "mb-4";
        zipContainer.innerHTML = `<div class="font-semibold text-sm mb-1">${city}</div>`;

        zips.forEach(zip => {
          const span = document.createElement("div");
          span.className = "text-xs text-gray-700 mb-1";
          span.textContent = zip;
          zipContainer.appendChild(span);
        });
        zipList.appendChild(zipContainer);

        const summaryItem = document.createElement("li");
        summaryItem.id = `summary_${state}_${city}`;
        summaryItem.textContent = `${city}`;
        summaryList.appendChild(summaryItem);
      } else {
        const zipBlock = document.getElementById(`zips_${state}_${city}`);
        if (zipBlock) zipBlock.remove();
        const summaryItem = document.getElementById(`summary_${state}_${city}`);
        if (summaryItem) summaryItem.remove();
      }

      const newCount = document.querySelectorAll("#summaryList li").length;
      counter.textContent = `Cities selected: ${newCount}`;
    }
  
    function toggleZipSelection(box) {
      const zip = box.dataset.zip;
      const city = box.dataset.city;
      const state = box.dataset.state;
      const summary = document.getElementById("summaryList");
      const counter = document.getElementById("zipCounter");
      const count = document.querySelectorAll("#summaryList li").length;

      if (box.checked) {
        if (count >= maxZips) {
          alert("You can only select up to 5 ZIP codes.");
          box.checked = false;
          return;
        }
        const li = document.createElement("li");
        li.id = `zip_${zip}`;
        li.textContent = `${city} ${zip}`;
        summary.appendChild(li);
      } else {
        const li = document.getElementById(`zip_${zip}`);
        if (li) li.remove();
      }

      const updated = document.querySelectorAll("#summaryList li").length;
      counter.textContent = `ZIPs selected: ${updated} of ${maxZips}`;
    }


    function toggleZipSelection(box) {
      const zip = box.dataset.zip;
      const city = box.dataset.city;
      const state = box.dataset.state;
      const summary = document.getElementById("summaryList");
      const counter = document.getElementById("zipCounter");

      let group = document.getElementById(`group_${city}`);
      if (box.checked) {
        const currentZipCount = document.querySelectorAll("#summaryList input[type=checkbox]:checked").length;
        if (currentZipCount >= maxZips) {
          alert("You can only select up to 5 ZIP codes.");
          box.checked = false;
          return;
        }

        if (!group) {
          group = document.createElement("div");
          group.id = `group_${city}`;
          group.className = "mb-2";
          group.innerHTML = `<strong class='text-sm text-gray-800'>${city}</strong><ul class='list-disc ml-4 text-sm' id='zips_${city}'></ul>`;
          summary.appendChild(group);
        }

        const ul = document.getElementById(`zips_${city}`);
        const li = document.createElement("li");
        li.id = `zip_${zip}`;
        li.textContent = zip;
        ul.appendChild(li);
      } else {
        const li = document.getElementById(`zip_${zip}`);
        if (li) li.remove();

        const ul = document.getElementById(`zips_${city}`);
        if (ul && ul.children.length === 0) {
          const parentGroup = document.getElementById(`group_${city}`);
          if (parentGroup) parentGroup.remove();
        }
      }

      const updated = document.querySelectorAll("#summaryList input[type=checkbox]:checked").length;
      const visibleZips = summary.querySelectorAll("li").length;
      counter.textContent = `ZIPs selected: ${visibleZips} of ${maxZips}`;
    }

</script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="max-w-7xl mx-auto px-6 py-10">
    <h1 class="text-3xl font-bold mb-6">Choose Your ZIP Code Service Area</h1>
    <p class="text-sm text-gray-600 mb-6">Select cities from across the U.S. ZIPs will appear based on your city selections. Limit: 5 ZIPs total.</p>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div id="stateList" class="border rounded-md p-4 bg-white max-h-[30rem] overflow-y-auto">
        <h2 class="font-semibold mb-2">States</h2>
      </div>

      <div id="cityList" class="border rounded-md p-4 bg-white max-h-[30rem] overflow-y-auto">
        <h2 class="font-semibold mb-2">Cities</h2>
      </div>

      <div id="zipList" class="border rounded-md p-4 bg-white max-h-[30rem] overflow-y-auto">
        <h2 class="font-semibold mb-2">ZIP Codes</h2>
      </div>

      <div class="border rounded-md p-4 bg-white max-h-[30rem] overflow-y-auto">
        <h2 class="font-semibold mb-2">Selected</h2>
        <p id="zipCounter" class="text-xs text-gray-500 mb-2">ZIPs selected: 0 of 5</p>
        <ul id="summaryList" class="list-disc ml-5 text-sm"></ul>
      </div>
    </div>
  </div>
</body>
</html>
