
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Select ZIP Codes – LeadTapApp</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script defer>
    const zipMap = {};
    const selectedZips = {};

    document.addEventListener("DOMContentLoaded", () => {

  const globalChosenList = document.getElementById("chosenZipList");
  const zipCounter = document.getElementById("zipCounter");

      const states = [
        "AK","AL","AR","AS","AZ","CA","CO","CT","DC","DE","FL","GA","GU","HI","IA","ID",
        "IL","IN","KS","KY","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","ND","NE",
        "NH","NJ","NM","NV","NY","OH","OK","OR","PA","PR","RI","SC","SD","TN","TX","UT",
        "VA","VI","VT","WA","WI","WV","WY"
      ];
      const grid = document.getElementById("stateGrid");
      states.forEach(code => {
        const btn = document.createElement("button");
        btn.textContent = code;
        btn.className = "state-btn bg-white border rounded px-3 py-2 hover:bg-blue-100";
        
btn.onclick = () => {
  btn.classList.toggle("bg-blue-600");
  btn.classList.toggle("text-white");
  btn.classList.toggle("border-blue-700");
  if (!document.getElementById(`section_${code}`)) {
    loadCitiesByState(code);
  } else {
    const section = document.getElementById(`section_${code}`);
    const showing = !section.classList.contains("hidden");
    section.classList.toggle("hidden", showing);
  }
};

        grid.appendChild(btn);
      });
    });

    async function loadCitiesByState(stateCode) {
      if (zipMap[stateCode]) {
        renderState(stateCode, zipMap[stateCode]);
        return;
      }

      try {
        const res = await fetch(`zip_map_${stateCode}.json`);
        if (!res.ok) throw new Error(`Missing file for ${stateCode}`);
        const data = await res.json();
        zipMap[stateCode] = data;
        renderState(stateCode, data);
      } catch (err) {
        alert(`Error loading ${stateCode}: ${err.message}`);
      }
    }

    function renderState(stateCode, data) {
      const stateWrapper = document.getElementById("statesWrapper");
      if (document.getElementById(`section_${stateCode}`)) return;

      const container = document.createElement("div");
      container.id = `section_${stateCode}`;
      container.className = "mb-10 border-t pt-6";

      const title = document.createElement("h2");
      title.textContent = `State: ${stateCode}`;
      title.className = "text-xl font-bold mb-4 text-blue-700";
      container.appendChild(title);

      const layout = document.createElement("div");
      layout.className = "grid grid-cols-1 md:grid-cols-2 gap-6";

      const cityList = document.createElement("div");
      cityList.className = "border p-4 bg-white rounded-md max-h-96 overflow-y-scroll text-sm";

      const zipList = document.createElement("div");
      zipList.className = "border p-4 bg-white rounded-md max-h-96 overflow-y-scroll text-sm";
      zipList.id = `zipList_${stateCode}`;

      const grouped = {};
      data.forEach(entry => {
        const firstLetter = entry.City.charAt(0).toUpperCase();
        if (!grouped[firstLetter]) grouped[firstLetter] = [];
        grouped[firstLetter].push(entry);
      });

      const sortedLetters = Object.keys(grouped).sort();
      sortedLetters.forEach(letter => {
        const section = document.createElement("div");
        const heading = document.createElement("h3");
        heading.className = "text-md font-bold text-gray-700 mt-2 mb-1";
        heading.textContent = letter;
        section.appendChild(heading);

        grouped[letter].forEach(entry => {
          const label = document.createElement("label");
          label.className = "block text-sm text-gray-800 mb-1";
          label.innerHTML = `<input type="checkbox" data-state="${stateCode}" data-zips='${JSON.stringify(entry["Zip Codes"])}' onchange="handleCityCheck(this)" class="mr-2"> ${entry.City}`;
          section.appendChild(label);
        });

        cityList.appendChild(section);
      });

      layout.appendChild(cityList);
      layout.appendChild(zipList);
const chosenList = document.createElement("div");
chosenList.className = "border p-4 bg-white rounded-md max-h-96 overflow-y-scroll text-sm";
chosenList.id = `chosenList_${stateCode}`;
layout.appendChild(chosenList);
      container.appendChild(layout);
      stateWrapper.appendChild(container);
    }

    function handleCityCheck(checkbox) {
      const zipContainer = document.getElementById(`zipList_${checkbox.dataset.state}`);
      const zips = JSON.parse(checkbox.getAttribute("data-zips"));
      const zipCount = document.querySelectorAll('.zip-checkbox').length;

      if (checkbox.checked) {
        if (zipCount + zips.length > 5) {
          alert("You can only select up to 5 ZIP codes total.");
          checkbox.checked = false;
          return;
        }

        zips.forEach(zip => {
          const id = `zip_${zip}`;
          if (!document.getElementById(id)) {
  const chosen = document.getElementById(`chosenList_${checkbox.dataset.state}`);
  const entry = document.createElement("div");
  entry.id = `chosen_${zip}`;
  entry.textContent = checkbox.parentElement.textContent.trim() + " " + zip;
  chosen.appendChild(entry);

  const li = document.createElement("li");
  li.id = `global_chosen_${zip}`;
  li.textContent = checkbox.parentElement.textContent.trim() + " " + zip;
  globalChosenList.appendChild(li);
  zipCounter.textContent = `ZIPs selected: ${document.querySelectorAll('.zip-checkbox').length} of 5`;

            const label = document.createElement("label");
            label.className = "block";
            label.innerHTML = `<div class="text-xs text-gray-800 mb-1">${zip}</div> ${zip}`;
            zipContainer.appendChild(label);
          }
        });
      } else {
        zips.forEach(zip => {
          const el = document.getElementById(`zip_${zip}`);
          if (el) el.parentElement.remove();
  const chosenEl = document.getElementById(`chosen_${zip}`);
  if (chosenEl) chosenEl.remove();

  const globalLi = document.getElementById(`global_chosen_${zip}`);
  if (globalLi) globalLi.remove();
  zipCounter.textContent = `ZIPs selected: ${document.querySelectorAll('.zip-checkbox').length} of 5`;

        });
      }
    }

    function showSummary() {
      const zipCheckboxes = document.querySelectorAll('.zip-checkbox');
      const summary = document.getElementById("summaryList");
      summary.innerHTML = "";
      zipCheckboxes.forEach(zip => {
        const li = document.createElement("li");
        li.textContent = zip.parentElement.textContent.trim();
        summary.appendChild(li);
      });

      document.getElementById("summaryZipCount").textContent = zipCheckboxes.length;
      document.getElementById("selectorSection").classList.add("hidden");
      document.getElementById("summarySection").classList.remove("hidden");
    }

    function goBack() {
      document.getElementById("summarySection").classList.add("hidden");
      document.getElementById("selectorSection").classList.remove("hidden");
    }

    function finalSubmit() {
      alert("Feature coming soon – save or send ZIPs!");
    }
  </script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div id="selectorSection" class="max-w-6xl mx-auto px-6 py-10">
    <h1 class="text-3xl font-bold mb-6">Choose Your Service Area</h1>
    <p class="mb-4 text-sm text-gray-600">Click any state to view cities. You can choose up to <strong>5 ZIP codes total</strong> from any combination of states.</p>

    <div id="stateGrid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2 mb-8"></div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div id="statesWrapper" class="md:col-span-2"></div>
<div id="chosenZipPanel" class="md:col-span-1 border p-4 bg-white rounded-md max-h-96 overflow-y-scroll text-sm sticky top-4 h-fit">
  <h3 class="font-bold text-gray-700 mb-2">CHOSEN ZIPS</h3>
  <p id="zipCounter" class="text-xs text-gray-500 mb-2">ZIPs selected: 0 of 5</p>
  <ul id="chosenZipList" class="list-disc ml-4 space-y-1 text-sm text-gray-800"></ul>
</div>
</div>

    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded my-6">
      <p><strong>Why only 5 ZIPs?</strong> Focusing on your top-performing areas leads to better results. You can update your ZIP selections anytime.</p>
    </div>

    <button onclick="showSummary()" class="bg-blue-700 text-white font-semibold px-6 py-3 rounded-xl hover:bg-blue-800">Continue</button>
  </div>

  <div id="summarySection" class="hidden bg-white p-6 rounded-md shadow-md max-w-4xl mx-auto mt-8">
    <h2 class="text-2xl font-bold mb-4">Your Selected ZIP Codes</h2>
    <ul id="summaryList" class="list-disc ml-5 mb-2 text-gray-700"></ul>
    <p><strong>Total ZIP Codes:</strong> <span id="summaryZipCount">0</span></p>

    <div class="mt-6 flex gap-4">
      <button onclick="goBack()" class="bg-gray-300 text-gray-800 font-semibold px-4 py-2 rounded-md hover:bg-gray-400">Go Back</button>
      <button onclick="finalSubmit()" class="bg-blue-700 text-white font-semibold px-4 py-2 rounded-md hover:bg-blue-800">Looks Good – Continue</button>
    </div>
  </div>
</body>
</html>
